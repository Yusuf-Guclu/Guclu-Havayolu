@{
    Layout = null;
}

@model Havayolu.Models.doubleModel.doubleModelClass

<!--Bootstrap-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>

<!--Unbounded Font Family-->
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
    .btn {
        background-color: #003580;
        transition: all 0.3s ease;
        color: white;
    }

    .btn:hover {
        background-color: #1a73e8 !important;
        color: white;
    }
</style>


<body class="bg-light">
    <div class="bg-white w-50 border border-2 rounded-3 border-dark mt-4 mb-5" style="margin-left: 25%;">
        <div class="container">
            <h2 class="mt-4 fw-bold text-center" style="font-family: Unbounded; color: #003580;">Ödeme Sayfası</h2>
            
            @if (Model.kayitListesi != null)
            {
                @foreach (var Bilet in Model.kayitListesi)
                {
                    <p class="text-secondary mt-4">Uçuş: @Bilet.nereden - @Bilet.nereye</p>
                    <p class="text-secondary">Kalkış Tarih: @Bilet.gidisTarihi</p>
                    <p class="text-secondary">Tutar: @Bilet.fiyat</p>
                }
            }
            

            <!--if (Model.kayitListesi.Any())    if ile listeleme
            {
                var Bilet = Model.kayitListesi.First();
                <p class="text-secondary mt-4">Uçuş: Bilet.nereden - Bilet.nereye</p>
                <p class="text-secondary">Tarih: Bilet.gidisTarihi</p>
                <p class="text-secondary">Tutar: Bilet.fiyat</p>
            }-->

            <br />
            <label class="form-label">Ödeme Yöntemi</label>
            <select class="form-select w-50 mb-2">
                <option disabled selected>Ödeme yöntemi seçiniz...</option>
                <option data-bs-toggle="modal" data-bs-target="#cardModal">Kart ile ödeme</option>
                <option>Havale / EFT</option>
                <option>Kapıda temassız kartla ödeme</option>
            </select>

            <form asp-action="payment">
                <div class="mt-5" id="onlineCard">
                    <hr />
                    <div class="row">
                        <div class="col-12">
                            <label asp-for="yeniKayit.kullaniciAdi" class="form-label">Kart Sahibinin Adı</label>
                            <input asp-for="yeniKayit.kullaniciAdi" class="form-control w-100" type="text" autocomplete="off" />
                            <span class="text-danger" asp-validation-for="yeniKayit.kullaniciAdi"></span>
                        </div>
                    </div>

                    <div class="row mt-2">
                        <div class="col-12">
                            <input asp-for="yeniKayit.kartNumarasi" class="form-control w-100" type="text" placeholder="Kart Numarası" id="cardNumber" inputmode="numeric" maxlength="19" autocomplete="off" />
                            <span class="text-danger" asp-validation-for="yeniKayit.kartNumarasi"></span>
                        </div>
                    </div>

                    <div class="row mt-2">
                        <div class="col-6">
                            <input asp-for="yeniKayit.ayYil" class="form-control" type="text" id="expiry" maxlength="5" inputmode="numeric" placeholder="Ay/Yıl" autocomplete="off" />
                            <span class="text-danger" asp-validation-for="yeniKayit.ayYil"></span>
                        </div>

                        <div class="col-6">
                            <input asp-for="yeniKayit.cvv" class="form-control" type="text" id="cvv" maxlength="3" inputmode="numeric" placeholder="CVV" autocomplete="off" />
                            <span class="text-danger" asp-validation-for="yeniKayit.cvv"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 d-flex">
                            <div class="mt-4" style="width: 20%;">
                                <input asp-for="yeniKayit.onay" class="form-check" type="checkbox" style="transform: scale(1.8); margin-left: 40%; margin-top: 40%;" />
                            </div>

                            <div class="mt-4" style="width: 80%;">
                                <p>Masterpass, kart bilgilerinizi güvenli bir şekilde saklayarak alışverişlerinizi hızlıca tamamlamanızı sağlar. Masterpass hesabınızı kullanarak, her seferinde kart bilgilerinizi girmek zorunda kalmazsınız. Hızlı ve güvenli bir ödeme deneyimi için Masterpass'ı seçin!<br />Masterpass kullanım şartları ve gizlilik politikasını <a href="#"><strong style="color: #003580;">buradan</strong></a> inceleyebilirsiniz.</p>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4 mb-5">
                        <div class="col-12">
                            <button class="btn py-2 px-5">Bilet Al</button>
                        </div>
                    </div>
                </div>
            </form>

            <div class="mt-3" id="eftHavale">
                <hr />
                <h4>Bu işlemi şu anda gerçekleştiremiyoruz!</h4>
            </div>

            <div class="mt-3" id="kapida">
                <hr />
                <h4>Bu işlemi şu anda gerçekleştiremiyoruz!</h4>
            </div>

            
           
        </div>
    </div>

    <script>
        // Select ile seçilen yöntemi gösterme kodu
        document.addEventListener('DOMContentLoaded', function () {
            const paymentSelect = document.querySelector('.form-select');
            const onlineCard = document.getElementById('onlineCard');
            const eftHavale = document.getElementById('eftHavale');
            const kapida = document.getElementById('kapida');
            // Tüm bölümleri başlangıçta gizle
            onlineCard.style.display = 'none';
            eftHavale.style.display = 'none';
            kapida.style.display = 'none';
            paymentSelect.addEventListener('change', function () {
                // Tüm bölümleri gizle
                onlineCard.style.display = 'none';
                eftHavale.style.display = 'none';
                kapida.style.display = 'none';
                // Seçilen ödeme yöntemine göre ilgili bölümü göster
                if (paymentSelect.value === 'Kart ile ödeme') {
                    onlineCard.style.display = 'block';
                } else if (paymentSelect.value === 'Havale / EFT') {
                    eftHavale.style.display = 'block';
                } else if (paymentSelect.value === 'Kapıda temassız kartla ödeme') {
                    kapida.style.display = 'block';
                }
            });
        });



        // Kart Numarası Kodu
            const cardInput = document.getElementById('cardNumber');
            cardInput.addEventListener('input', function(e) {
                // Sadece rakam ve boşluklar tutulacak, diğer karakterler silinecek
                let value = cardInput.value.replace(/\D/g, '');
                    // Maksimum 16 rakam kabul edilir (4x4)
                    if(value.length > 16) {
                value = value.slice(0, 16);
                    }
            // 4'lü gruplar halinde araya boşluk koy
            let formattedValue = '';
            for(let i = 0; i < value.length; i++) {
                        if(i > 0 && i % 4 === 0) {
                formattedValue += ' ';
                        }
            formattedValue += value[i];
                    }
            // Cursor pozisyonunu korumak için input değerini güncelle
            cardInput.value = formattedValue;
                });



            // Ay/Yıl ve CVV inputu
        const expiryInput = document.getElementById('expiry');
        const cvvInput = document.getElementById('cvv');

        expiryInput.addEventListener('input', (e) => {
            let value = e.target.value;

            // Sadece rakam ve "/" olabilir, fakat "/" sadece 3. karakter olabilir
            // İlk olarak / kaldır
            value = value.replace(/[^0-9]/g, '');

            if (value.length > 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }

            // Maksimum 5 karakter olmalı: "MM/YY"
            if (value.length > 5) {
                value = value.slice(0, 5);
            }

            e.target.value = value;
        });

        // CVV input için sadece 3 karakter rakam izin ver
        cvvInput.addEventListener('input', (e) => {
            let value = e.target.value;

            // Sadece rakam
            value = value.replace(/[^0-9]/g, '');

            // Maks 3 karakter
            if (value.length > 3) {
                value = value.slice(0, 3);
            }

            e.target.value = value;
        });
    </script>

</body>